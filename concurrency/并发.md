### 并发

#### JAVA 内存模型

1. 原子性

原子性是指一个操作不可中断，即使是多个线程一起执行，一个操作一旦开始，就不会被其他线程干扰。比如：对于一个静态全局的int i赋值，两个线程给它赋值，线程A给它赋值1，线程B给它赋值-1，那么i的值要么是1要么是-1，线程A和线程B之间没有干扰。这就是原子性的一个特点，不可被中断。

但是如果long类型，对于32为系统来说就不是原子性了，因为long是64位。

2. 可见性

可见性是指当一个线程修改了某一个共享变量的值，其它线程是否能够立即知道这个修改。

3. 有序性

程序执行时，并不一定会按照先后顺序执行，因为程序执行时，可能会进行指令重排，重排后的指令与原指令顺序未必一致。

#### Happen-Before规则

* 程序顺序原则：一个线程内保证语义的串行性。
* volatitle规则：volatitle变量的写，先发于读，这保证了volatile变量的可见性。
* 锁规则：解锁必然发生在随后的加锁前。
* 传递性：A先于B，B先于C，那么A必然先于C。
* 线程的start()方法先于它的每一个动作。
* 线程的所有操作先于线程的终结（Thread.join()）。
* 线程的中断(interrupt())先于被中断线程的代码。
* 对象的构造函数执行、结束先于finalize()方法。

